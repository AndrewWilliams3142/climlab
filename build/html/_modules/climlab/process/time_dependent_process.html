<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>climlab.process.time_dependent_process &mdash; climlab 0.3.2 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.3.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="climlab 0.3.2 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../../index.html"><img src="../../../_static/logo.png" border="0" alt="sampledoc"/></a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../intro.html">home</a>|&nbsp;</li>
        <li><a href="../../../search.html">search</a>|&nbsp;</li>
        <!-- 
	<li><a href="../../../contents.html">documentation </a> &raquo;</li>
	-->

          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../download.html">Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/climlab.html">Application Programming Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contact.html">Contact</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput > div,
div.nbinput div[class^=highlight],
div.nbinput div[class^=highlight] pre,
div.nboutput,
div.nboutput > div,
div.nboutput div[class^=highlight],
div.nboutput div[class^=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput > :first-child pre {
    color: navy;
}

/* output prompt */
div.nboutput > :first-child pre {
    color: darkred;
}

/* all prompts */
div.nbinput > :first-child[class^=highlight],
div.nboutput > :first-child[class^=highlight],
div.nboutput > :first-child {
    min-width: 11ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}

/* input/output area */
div.nbinput > :nth-child(2)[class^=highlight],
div.nboutput > :nth-child(2),
div.nboutput > :nth-child(2)[class^=highlight] {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
}

/* input area */
div.nbinput > :nth-child(2)[class^=highlight] {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput  > :nth-child(2).stderr {
    background: #fdd;
}

/* ANSI colors */
.ansiblack { color: black; }
.ansired { color: darkred; }
.ansigreen { color: darkgreen; }
.ansiyellow { color: #c4a000; }
.ansiblue { color: darkblue; }
.ansipurple { color: darkviolet; }
.ansicyan { color: steelblue; }
/* See https://github.com/jupyter/nbconvert/issues/174 */
.ansigray { color: gray; }  /* nbconvert CSS */
.ansigrey { color: gray; }  /* nbconvert HTML output */

.ansibgblack { background-color: black; }
.ansibgred { background-color: red; }
.ansibggreen { background-color: green; }
.ansibgyellow { background-color: yellow; }
.ansibgblue { background-color: blue; }
.ansibgpurple { background-color: magenta; }
.ansibgcyan { background-color: cyan; }
.ansibggray { background-color: gray; }

.ansibold { font-weight: bold; }
</style>
<h1>Source code for climlab.process.time_dependent_process</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">climlab</span> <span class="kn">import</span> <span class="n">constants</span> <span class="k">as</span> <span class="n">const</span>
<span class="kn">from</span> <span class="nn">climlab.process.process</span> <span class="kn">import</span> <span class="n">Process</span>
<span class="kn">from</span> <span class="nn">climlab.utils.walk</span> <span class="kn">import</span> <span class="n">walk_processes</span>


<div class="viewcode-block" id="TimeDependentProcess"><a class="viewcode-back" href="../../../api/climlab.process.html#climlab.process.time_dependent_process.TimeDependentProcess">[docs]</a><span class="k">class</span> <span class="nc">TimeDependentProcess</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A generic parent class for all time-dependent processes.</span>
<span class="sd">    </span>
<span class="sd">    ``TimeDependentProcess`` is a child of the </span>
<span class="sd">    :class:`~climlab.process.process.Process` class and therefore inherits</span>
<span class="sd">    all those attributes.</span>
<span class="sd">    </span>
<span class="sd">    **Initialization parameters** \n</span>
<span class="sd">    </span>
<span class="sd">    An instance of ``TimeDependentProcess`` is initialized with the following </span>
<span class="sd">    arguments *(for detailed information see Object attributes below)*:</span>
<span class="sd">    </span>
<span class="sd">    :param float timestep:  specifies the timestep of the object (optional)</span>
<span class="sd">    :param str time_type:   how time-dependent-process should be computed </span>
<span class="sd">                            [default: &#39;explicit&#39;]            </span>
<span class="sd">    :param bool topdown:    whether geneterate *process_types* in regular or </span>
<span class="sd">                            in reverse order [default: True] </span>
<span class="sd">    </span>
<span class="sd">    **Object attributes** \n</span>
<span class="sd">    </span>
<span class="sd">    Additional to the parent class :class:`~climlab.process.process.Process`</span>
<span class="sd">    following object attributes are generated during initialization:</span>
<span class="sd">    </span>
<span class="sd">    :ivar bool has_process_type_list:    </span>
<span class="sd">                            information whether attribute *process_types* </span>
<span class="sd">                            (which is needed for :func:`compute` and build in</span>
<span class="sd">                            :func:`_build_process_type_list`)</span>
<span class="sd">                            exists or not. Attribute is set to ``&#39;False&#39;`` </span>
<span class="sd">                            during initialization.   </span>
<span class="sd">    :ivar bool topdown:     information whether the list *process_types* (which </span>
<span class="sd">                            contains all processes and sub-processes) should be </span>
<span class="sd">                            generated in regular or in reverse order.</span>
<span class="sd">                            See :func:`_build_process_type_list`. </span>
<span class="sd">    :ivar dict timeave:     a time averaged collection of all states and diagnostic </span>
<span class="sd">                            processes over the timeperiod that </span>
<span class="sd">                            :func:`integrate_years` has been called for last.          </span>
<span class="sd">    :ivar dict tendencies:  computed difference in a timestep for each state. </span>
<span class="sd">                            See :func:`compute` for details.</span>
<span class="sd">    :ivar str time_type:    how time-dependent-process should be computed. </span>
<span class="sd">                            Possible values are: ``&#39;explicit&#39;``, ``&#39;implicit&#39;``,</span>
<span class="sd">                            ``&#39;diagnostic&#39;``, ``&#39;adjustment&#39;``.</span>
<span class="sd">    :ivar dict time:        a collection of all time-related attributes of the process. </span>
<span class="sd">                            The dictionary contains following items:</span>
<span class="sd">                            </span>
<span class="sd">        * ``&#39;timestep&#39;``: see initialization parameter</span>
<span class="sd">        * ``&#39;num_steps_per_year&#39;``: see :func:`set_timestep` and :func:`timestep` for details</span>
<span class="sd">        * ``&#39;day_of_year_index&#39;``: counter how many steps have been integrated in current year</span>
<span class="sd">        * ``&#39;steps&#39;``: counter how many steps have been integrated in total</span>
<span class="sd">        * ``&#39;days_elapsed&#39;``: time counter for days</span>
<span class="sd">        * ``&#39;years_elapsed&#39;``: time counter for years</span>
<span class="sd">        * ``&#39;days_of_year&#39;``: array which holds the number of numerical steps per year, expressed in days</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_type</span><span class="o">=</span><span class="s1">&#39;explicit&#39;</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">topdown</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Create the state dataset</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TimeDependentProcess</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tendencies</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tendencies</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">var</span> <span class="o">*</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeave</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">timestep</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_timestep</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_timestep</span><span class="p">(</span><span class="n">timestep</span><span class="o">=</span><span class="n">timestep</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_type</span> <span class="o">=</span> <span class="n">time_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topdown</span> <span class="o">=</span> <span class="n">topdown</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_process_type_list</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">timestep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The amount of time over which :func:`step_forward` is integrating in unit seconds.</span>

<span class="sd">        :getter: Returns the object timestep which is stored in ``self.param[&#39;timestep&#39;]``.</span>
<span class="sd">        :setter: Sets the timestep to the given input. See also :func:`set_timestep`.</span>
<span class="sd">        :type: float</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;timestep&#39;</span><span class="p">]</span>       
    <span class="nd">@timestep.setter</span>
    <span class="k">def</span> <span class="nf">timestep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">num_steps_per_year</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">seconds_per_year</span> <span class="o">/</span> <span class="n">value</span>
        <span class="n">timestep_days</span> <span class="o">=</span> <span class="n">value</span> <span class="o">/</span> <span class="n">const</span><span class="o">.</span><span class="n">seconds_per_day</span>
        <span class="n">days_of_year</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">const</span><span class="o">.</span><span class="n">days_per_year</span><span class="p">,</span> <span class="n">timestep_days</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;timestep&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
                     <span class="s1">&#39;num_steps_per_year&#39;</span><span class="p">:</span> <span class="n">num_steps_per_year</span><span class="p">,</span>
                     <span class="s1">&#39;day_of_year_index&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="s1">&#39;steps&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="s1">&#39;days_elapsed&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="s1">&#39;years_elapsed&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="s1">&#39;days_of_year&#39;</span><span class="p">:</span> <span class="n">days_of_year</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;timestep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="TimeDependentProcess.set_timestep"><a class="viewcode-back" href="../../../api/climlab.process.html#climlab.process.time_dependent_process.TimeDependentProcess.set_timestep">[docs]</a>    <span class="k">def</span> <span class="nf">set_timestep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">seconds_per_day</span><span class="p">,</span> <span class="n">num_steps_per_year</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the timestep in unit seconds</span>
<span class="sd">        and calls the setter function of :func:`timestep`</span>
<span class="sd">        </span>
<span class="sd">        :param float timestep:              the amount of time over which </span>
<span class="sd">                                            :func:`step_forward` is integrating </span>
<span class="sd">                                            in unit seconds [default: 24*60*60]</span>
<span class="sd">        :param float num_steps_per_year:    a number of steps per calendar year </span>
<span class="sd">                                            (optional)</span>
<span class="sd">        </span>
<span class="sd">        If the parameter *num_steps_per_year* is specified and not ``None``, </span>
<span class="sd">        the timestep is calculated accordingly and therefore the given input</span>
<span class="sd">        parameter *timestep* is ignored.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">num_steps_per_year</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">timestep</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">seconds_per_year</span> <span class="o">/</span> <span class="n">num_steps_per_year</span>
        <span class="c1"># Need a more sensible approach for annual cycle stuff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestep</span> <span class="o">=</span> <span class="n">timestep</span></div>

<div class="viewcode-block" id="TimeDependentProcess.compute"><a class="viewcode-back" href="../../../api/climlab.process.html#climlab.process.time_dependent_process.TimeDependentProcess.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes the tendencies for all state variables given current state </span>
<span class="sd">        and specified input.</span>
<span class="sd">  </span>
<span class="sd">        The function first computes all diagnostic processes. They don&#39;t produce </span>
<span class="sd">        any tendencies directly but they may effect the other processes (such as</span>
<span class="sd">        change in solar distribution). Subsequently, all tendencies and </span>
<span class="sd">        diagnostics for all explicit processes are computed.</span>
<span class="sd">        </span>
<span class="sd">        Tendencies due to implicit and adjustment processes need to be</span>
<span class="sd">        calculated from a state that is already adjusted after explicit </span>
<span class="sd">        alteration. For that reason the explicit tendencies are applied to the </span>
<span class="sd">        states temporarily. Now all tendencies from implicit processes are </span>
<span class="sd">        calculated by matrix inversions and similar to the explicit tendencies,</span>
<span class="sd">        the implicit ones are applied to the states temporarily. Subsequently,</span>
<span class="sd">        all instantaneous adjustments are computed.</span>
<span class="sd">        </span>
<span class="sd">        Then the changes that were made to the states from explicit and implicit </span>
<span class="sd">        processes are removed again as this </span>
<span class="sd">        :class:`~climlab.process.time_dependent_process.TimeDependentProcess.compute()`</span>
<span class="sd">        function is supposed to calculate only tendencies and not apply them </span>
<span class="sd">        to the states.</span>
<span class="sd">        </span>
<span class="sd">        Finally, all calculated tendencies from all processes are collected </span>
<span class="sd">        for each state, summed up and stored in the dictionary </span>
<span class="sd">        ``self.tendencies``, which is an attribute of the time-dependent-process </span>
<span class="sd">        object, for which the </span>
<span class="sd">        :class:`~climlab.process.time_dependent_process.TimeDependentProcess.compute()`</span>
<span class="sd">        method has been called.</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        **Object attributes** \n</span>
<span class="sd">        </span>
<span class="sd">        During method execution following object attributes are modified:</span>
<span class="sd">        </span>
<span class="sd">        :ivar dict tendencies:  dictionary that holds tendencies for all states</span>
<span class="sd">                                is calculated for current timestep through </span>
<span class="sd">                                adding up tendencies from explicit, implicit and</span>
<span class="sd">                                adjustment processes.</span>
<span class="sd">        :ivar dict diagnostics: process diagnostic dictionary is updated </span>
<span class="sd">                                by diagnostic dictionaries of subprocesses </span>
<span class="sd">                                after computation of tendencies.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_process_type_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_build_process_type_list</span><span class="p">()</span>
        <span class="c1"># First compute all strictly diagnostic processes</span>
        <span class="n">ignored</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_type</span><span class="p">(</span><span class="s1">&#39;diagnostic&#39;</span><span class="p">)</span>
        <span class="c1"># Compute tendencies and diagnostics for all explicit processes</span>
        <span class="n">tendencies_explicit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_type</span><span class="p">(</span><span class="s1">&#39;explicit&#39;</span><span class="p">)</span>
        <span class="c1">#  Tendencies due to implicit and adjustment processes need to be</span>
        <span class="c1">#  calculated from a state that is already adjusted after explicit stuff</span>
        <span class="c1">#  So apply the tendencies temporarily and then remove them again</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">var</span> <span class="o">+=</span> <span class="n">tendencies_explicit</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestep</span>
        <span class="c1"># Now compute all implicit processes -- matrix inversions</span>
        <span class="n">tendencies_implicit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_type</span><span class="p">(</span><span class="s1">&#39;implicit&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">var</span> <span class="o">+=</span> <span class="n">tendencies_implicit</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestep</span>
        <span class="c1"># Finally compute all instantaneous adjustments</span>
        <span class="c1">#  and express in terms of discrete timestep</span>
        <span class="n">adjustments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_type</span><span class="p">(</span><span class="s1">&#39;adjustment&#39;</span><span class="p">)</span>
        <span class="n">tendencies_adjustment</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">adjustments</span><span class="p">:</span>
            <span class="n">tendencies_adjustment</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">adjustments</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestep</span>
        <span class="c1">#  Now remove the changes from the model state</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">var</span> <span class="o">-=</span> <span class="p">(</span> <span class="p">(</span><span class="n">tendencies_implicit</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">+</span> <span class="n">tendencies_explicit</span><span class="p">[</span><span class="n">name</span><span class="p">])</span> <span class="o">*</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">timestep</span><span class="p">)</span>
        <span class="c1"># Finally sum up all the tendencies from all processes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tendencies</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">varname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tendencies</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">tend_dict</span> <span class="ow">in</span> <span class="p">[</span><span class="n">tendencies_explicit</span><span class="p">,</span>
                          <span class="n">tendencies_implicit</span><span class="p">,</span>
                          <span class="n">tendencies_adjustment</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">tend_dict</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tendencies</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">+=</span> <span class="n">tend_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="c1">#  pass diagnostics up the process tree</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">proc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subprocess</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="c1">#self.add_diagnostics(proc.diagnostics.keys())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diagnostics</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">proc</span><span class="o">.</span><span class="n">diagnostics</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_compute_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proctype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes tendencies due to all subprocesses of given type </span>
<span class="sd">        ``&#39;proctype&#39;``.&quot;&quot;&quot;</span>
        <span class="n">tendencies</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">varname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">:</span>
            <span class="n">tendencies</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">proc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_types</span><span class="p">[</span><span class="n">proctype</span><span class="p">]:</span>
            <span class="n">proc</span><span class="o">.</span><span class="n">tendencies</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">_compute</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">varname</span><span class="p">,</span> <span class="n">tend</span> <span class="ow">in</span> <span class="n">proc</span><span class="o">.</span><span class="n">tendencies</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">tendencies</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span> <span class="o">+=</span> <span class="n">tend</span>
        <span class="k">return</span> <span class="n">tendencies</span>

    <span class="k">def</span> <span class="nf">_compute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># where the tendencies are actually computed...</span>
        <span class="c1">#  needs to be implemented for each daughter class</span>
        <span class="c1">#  needs to return a dictionary with same keys as self.state</span>
        <span class="n">tendencies</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">tendencies</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="o">*</span> <span class="mf">0.</span>
        <span class="k">return</span> <span class="n">tendencies</span>

    <span class="k">def</span> <span class="nf">_build_process_type_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates lists of processes organized by process type.</span>
<span class="sd">        </span>
<span class="sd">        Following object attributes are generated or updated:</span>
<span class="sd">    </span>
<span class="sd">        :ivar dict process_types:   a dictionary with entries:  </span>
<span class="sd">                                    ``&#39;diagnostic&#39;``, ``&#39;explicit&#39;``,</span>
<span class="sd">                                    ``&#39;implicit&#39;`` and ``&#39;adjustment&#39;`` which</span>
<span class="sd">                                    point to a list of processes according to</span>
<span class="sd">                                    the process types.</span>
<span class="sd">        </span>
<span class="sd">        The ``process_types`` dictionary is created while walking </span>
<span class="sd">        through the processes with :func:`~climlab.utils.walk.walk_processes`</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_types</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;diagnostic&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;explicit&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;implicit&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;adjustment&#39;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">proc</span><span class="p">,</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">walk_processes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topdown</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">topdown</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_types</span><span class="p">[</span><span class="n">proc</span><span class="o">.</span><span class="n">time_type</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">proc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_process_type_list</span> <span class="o">=</span> <span class="bp">True</span>

<div class="viewcode-block" id="TimeDependentProcess.step_forward"><a class="viewcode-back" href="../../../api/climlab.process.html#climlab.process.time_dependent_process.TimeDependentProcess.step_forward">[docs]</a>    <span class="k">def</span> <span class="nf">step_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates state variables with computed tendencies.</span>
<span class="sd">        </span>
<span class="sd">        Calls the :func:`compute` method to get current tendencies for all</span>
<span class="sd">        process states. Multiplied with the timestep and added up to the state</span>
<span class="sd">        variables is updating all model states.</span>
<span class="sd">        </span>
<span class="sd">        :Example:</span>
<span class="sd">            </span>
<span class="sd">            ::</span>
<span class="sd">            </span>
<span class="sd">                &gt;&gt;&gt; import climlab</span>
<span class="sd">                &gt;&gt;&gt; model = climlab.EBM()</span>
<span class="sd">                </span>
<span class="sd">                &gt;&gt;&gt; # checking time step counter</span>
<span class="sd">                &gt;&gt;&gt; model.time[&#39;steps&#39;]</span>
<span class="sd">                0</span>

<span class="sd">                &gt;&gt;&gt; # stepping the model forward</span>
<span class="sd">                &gt;&gt;&gt; model.step_forward()</span>
<span class="sd">                </span>
<span class="sd">                &gt;&gt;&gt; # step counter increased</span>
<span class="sd">                &gt;&gt;&gt; model.time[&#39;steps&#39;]</span>
<span class="sd">                1</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
        <span class="c1">#  Total tendency is applied as an explicit forward timestep</span>
        <span class="c1"># (already accounting properly for order of operations in compute() )</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">var</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tendencies</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;timestep&#39;</span><span class="p">]</span>

        <span class="c1"># Update all time counters for this and all subprocesses in the tree</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">proc</span><span class="p">,</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">walk_processes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">proc</span><span class="o">.</span><span class="n">_update_time</span><span class="p">()</span></div>

<div class="viewcode-block" id="TimeDependentProcess.compute_diagnostics"><a class="viewcode-back" href="../../../api/climlab.process.html#climlab.process.time_dependent_process.TimeDependentProcess.compute_diagnostics">[docs]</a>    <span class="k">def</span> <span class="nf">compute_diagnostics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_iter</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute all tendencies and diagnostics, but don&#39;t update model state.</span>
<span class="sd">        By default it will call compute() 3 times to make sure all</span>
<span class="sd">        subprocess coupling is accounted for. The number of iterations can</span>
<span class="sd">        be changed with the input argument.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_iter</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_update_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Increments the timestep counter by one.</span>
<span class="sd">        </span>
<span class="sd">        Furthermore ``self.time[&#39;days_elapsed&#39;]`` and</span>
<span class="sd">        ``self.time[&#39;num_steps_per_year&#39;]`` are updated.</span>
<span class="sd">        </span>
<span class="sd">        The function is called by the time stepping methods.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="s1">&#39;steps&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># time in days since beginning</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="s1">&#39;days_elapsed&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="s1">&#39;timestep&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">const</span><span class="o">.</span><span class="n">seconds_per_day</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="s1">&#39;day_of_year_index&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="s1">&#39;num_steps_per_year&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_do_new_calendar_year</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="s1">&#39;day_of_year_index&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_do_new_calendar_year</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function is called once at the end of every calendar year.</span>
<span class="sd">        </span>
<span class="sd">        It updates ``self.time[&#39;years_elapsed&#39;]`` and </span>
<span class="sd">        ``self.time[&#39;day_of_year_index&#39;]``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="s1">&#39;day_of_year_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># back to Jan. 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="s1">&#39;years_elapsed&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

<div class="viewcode-block" id="TimeDependentProcess.integrate_years"><a class="viewcode-back" href="../../../api/climlab.process.html#climlab.process.time_dependent_process.TimeDependentProcess.integrate_years">[docs]</a>    <span class="k">def</span> <span class="nf">integrate_years</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">years</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Integrates the model by a given number of years.</span>
<span class="sd">        </span>
<span class="sd">        :param float years:     integration time for the model in years     </span>
<span class="sd">                                [default: 1.0]</span>
<span class="sd">        :param bool verbose:    information whether model time details </span>
<span class="sd">                                should be printed [default: True]</span>
<span class="sd">        </span>
<span class="sd">        It calls :func:`step_forward` repetitively and calculates a time </span>
<span class="sd">        averaged value over the integrated period for every model state and all</span>
<span class="sd">        diagnostics processes.</span>

<span class="sd">        :Example:</span>
<span class="sd">        </span>
<span class="sd">            ::</span>
<span class="sd">            </span>
<span class="sd">                &gt;&gt;&gt; import climlab</span>
<span class="sd">                &gt;&gt;&gt; model = climlab.EBM()</span>
<span class="sd">                </span>
<span class="sd">                &gt;&gt;&gt; model.global_mean_temperature()</span>
<span class="sd">                Field(11.997968598413685)</span>
<span class="sd">                </span>
<span class="sd">                &gt;&gt;&gt; model.integrate_years(2.)</span>
<span class="sd">                Integrating for 180 steps, 730.4844 days, or 2.0 years.</span>
<span class="sd">                Total elapsed time is 2.0 years.</span>
<span class="sd">                                                </span>
<span class="sd">                &gt;&gt;&gt; model.global_mean_temperature()</span>
<span class="sd">                Field(13.531055349437258)</span>
<span class="sd">                </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">days</span> <span class="o">=</span> <span class="n">years</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">days_per_year</span>
        <span class="n">numsteps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="s1">&#39;num_steps_per_year&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">years</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Integrating for &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">numsteps</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; steps, &quot;</span>
                  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">days</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; days, or &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">years</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; years.&quot;</span><span class="p">)</span>
        <span class="c1">#  begin time loop</span>
        <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numsteps</span><span class="p">):</span>
            <span class="c1"># Compute the timestep</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step_forward</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># on first step only...</span>
                <span class="c1">#  This implements a generic time-averaging feature</span>
                <span class="c1"># using the list of model state variables</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timeave</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="c1"># add any new diagnostics to the timeave dictionary</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timeave</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">diagnostics</span><span class="p">)</span>
                <span class="c1"># reset all values to zero</span>
                <span class="k">for</span> <span class="n">varname</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeave</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">timeave</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="o">*</span><span class="n">value</span>
            <span class="c1"># adding up all values for each timestep</span>
            <span class="k">for</span> <span class="n">varname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeave</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">timeave</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">timeave</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diagnostics</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span>
                    <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
        <span class="c1"># calculating mean values through dividing the sum by number of steps</span>
        <span class="k">for</span> <span class="n">varname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeave</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timeave</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span> <span class="o">/=</span> <span class="n">numsteps</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Total elapsed time is </span><span class="si">%s</span><span class="s2"> years.&quot;</span>
                  <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="s1">&#39;days_elapsed&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">const</span><span class="o">.</span><span class="n">days_per_year</span><span class="p">))</span></div>

<div class="viewcode-block" id="TimeDependentProcess.integrate_days"><a class="viewcode-back" href="../../../api/climlab.process.html#climlab.process.time_dependent_process.TimeDependentProcess.integrate_days">[docs]</a>    <span class="k">def</span> <span class="nf">integrate_days</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Integrates the model forward for a specified number of days.</span>
<span class="sd">        </span>
<span class="sd">        It convertes the given number of days into years and calls </span>
<span class="sd">        :func:`integrate_years`.</span>
<span class="sd">        </span>
<span class="sd">        :param float days:      integration time for the model in days      </span>
<span class="sd">                                [default: 1.0]</span>
<span class="sd">        :param bool verbose:    information whether model time details </span>
<span class="sd">                                should be printed [default: True]</span>
<span class="sd">        </span>
<span class="sd">        :Example:</span>
<span class="sd">        </span>
<span class="sd">            ::</span>
<span class="sd">            </span>
<span class="sd">                &gt;&gt;&gt; import climlab</span>
<span class="sd">                &gt;&gt;&gt; model = climlab.EBM()</span>
<span class="sd">                </span>
<span class="sd">                &gt;&gt;&gt; model.global_mean_temperature()</span>
<span class="sd">                Field(11.997968598413685)</span>
<span class="sd">                </span>
<span class="sd">                &gt;&gt;&gt; model.integrate_days(80.)</span>
<span class="sd">                Integrating for 19 steps, 80.0 days, or 0.219032740466 years.</span>
<span class="sd">                Total elapsed time is 0.211111111111 years.</span>
<span class="sd">                                </span>
<span class="sd">                &gt;&gt;&gt; model.global_mean_temperature()</span>
<span class="sd">                Field(11.873680783355553)</span>
<span class="sd">                </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">years</span> <span class="o">=</span> <span class="n">days</span> <span class="o">/</span> <span class="n">const</span><span class="o">.</span><span class="n">days_per_year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">integrate_years</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="n">years</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span></div>

<div class="viewcode-block" id="TimeDependentProcess.integrate_converge"><a class="viewcode-back" href="../../../api/climlab.process.html#climlab.process.time_dependent_process.TimeDependentProcess.integrate_converge">[docs]</a>    <span class="k">def</span> <span class="nf">integrate_converge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crit</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Integrates the model until model states are converging.</span>
<span class="sd">        </span>
<span class="sd">        :param crit:            exit criteria for difference of iterated</span>
<span class="sd">                                solutions [default: 0.0001]</span>
<span class="sd">        :type crit:             float</span>
<span class="sd">        :param bool verbose:    information whether total elapsed time </span>
<span class="sd">                                should be printed [default: True]</span>
<span class="sd">        </span>
<span class="sd">        :Example:</span>
<span class="sd">        </span>
<span class="sd">            ::</span>
<span class="sd">            </span>
<span class="sd">                &gt;&gt;&gt; import climlab</span>
<span class="sd">                &gt;&gt;&gt; model = climlab.EBM()</span>
<span class="sd">                </span>
<span class="sd">                &gt;&gt;&gt; model.global_mean_temperature()</span>
<span class="sd">                Field(11.997968598413685)</span>
<span class="sd">                </span>
<span class="sd">                &gt;&gt;&gt; model.integrate_converge()</span>
<span class="sd">                Total elapsed time is 10.0 years.</span>
<span class="sd">                </span>
<span class="sd">                &gt;&gt;&gt; model.global_mean_temperature()</span>
<span class="sd">                Field(14.288155406577301)</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># implemented by m-kreuzer</span>
        <span class="k">for</span> <span class="n">varname</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">value_old</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">integrate_years</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">value_old</span><span class="o">-</span><span class="n">value</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">crit</span> <span class="p">:</span>
                <span class="n">value_old</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">integrate_years</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Total elapsed time is </span><span class="si">%s</span><span class="s2"> years.&quot;</span>
                  <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="s1">&#39;days_elapsed&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">const</span><span class="o">.</span><span class="n">days_per_year</span><span class="p">))</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../intro.html">home</a>|&nbsp;</li>
        <li><a href="../../../search.html">search</a>|&nbsp;</li>
        <!-- 
	<li><a href="../../../contents.html">documentation </a> &raquo;</li>
	-->

          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016 (licensed under MIT License), Moritz Kreuzer &amp; Brian Rose.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.5.
    </div>
  </body>
</html>